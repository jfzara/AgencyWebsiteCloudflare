---
import Paragraph from '../shared/Paragraph.astro';

export interface Props {
    title: string,
    description: string,
    icon: string
}

const { title, description, icon } = Astro.props;
---

<div class="service-card">
    <div class="card-content rounded-3xl relative min-h-[292px]"> <!-- Augmenté de 0.75rem (12px) -->
        <div class="content-wrapper relative rounded-3xl">
            <!-- Contenu principal (toujours visible) -->
            <div class="main-content flex flex-col items-center justify-center text-center gap-4 relative z-10 bg-box-bg border border-gray-200/20 rounded-3xl h-[292px]"> <!-- Hauteur fixe ajustée -->
                <div class="icon-wrapper w-16 h-16 rounded-xl bg-gray-300 dark:bg-gray-950 flex items-center justify-center">
                    <div class="icon-container w-10 h-10 flex items-center justify-center text-gray-800 dark:text-white">
                        <div class="w-full h-full">
                            <slot set:html={icon} />
                        </div>
                    </div>
                </div>
                <h2 class="text-lg md:text-xl font-semibold text-heading-2">
                    {title}
                </h2>
                
                <!-- Bouton + -->
                <button class="expand-btn w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-800 flex items-center justify-center transition-all duration-300 hover:bg-gray-300 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 transition-transform duration-300">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                </button>
            </div>

            <!-- Description (initialement cachée) -->
            <div class="description-content absolute top-[calc(100%+1rem)] left-0 right-0 z-0 opacity-0 px-4">
                <Paragraph>
                    {description}
                </Paragraph>
            </div>
        </div>
    </div>
</div>

<style>
.service-card {
    position: relative;
    width: 100%;
}

.card-content {
    transition: all 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    overflow: hidden;
    position: relative;
}

.content-wrapper {
    transition: transform 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.main-content {
    transition: transform 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    padding: 2rem;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.description-content {
    transition: all 1.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform: translateY(10px);
}

/* État actif */
.service-card.active .card-content {
    min-height: 436px; /* Augmenté de 0.75rem (12px) */
}

.service-card.active .content-wrapper {
    transform: translateY(-15%);
}

.service-card.active .description-content {
    opacity: 1;
    transform: translateY(0);
}

.service-card.active .expand-btn svg {
    transform: rotate(45deg);
}

:global(.icon-container svg) {
    width: 100%;
    height: 100%;
}

/* Hover effect pour desktop */
@media (min-width: 768px) {
    .expand-btn:hover {
        transform: scale(1.1);
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll<HTMLElement>('.service-card');
    let activeCard: HTMLElement | null = null;
    let timer: number | null = null;

    document.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        if (!target.closest('.service-card') && !target.closest('.expand-btn') && activeCard) {
            activeCard.classList.remove('active');
            activeCard = null;
        }
    });

    cards.forEach(card => {
        const expandBtn = card.querySelector('.expand-btn');

        function hideCard(): void {
            card.classList.remove('active');
            if (activeCard === card) {
                activeCard = null;
            }
        }

        function showCard(e: Event): void {
            e.stopPropagation();
            
            if (card === activeCard) {
                hideCard();
                return;
            }

            if (activeCard) {
                activeCard.classList.remove('active');
            }
            
            card.classList.add('active');
            activeCard = card;
            
            if (timer) clearTimeout(timer);
            timer = setTimeout(hideCard, 5000);
        }

        expandBtn?.addEventListener('click', (e) => {
            e.stopPropagation();
            showCard(e);
        });
    });
});
</script>